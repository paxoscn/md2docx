# Implementation Plan

- [x] 1. 创建编号模块的基础结构和错误处理
  - 创建 `src/numbering/mod.rs` 模块文件，定义模块结构和公共接口
  - 实现 `NumberingError` 错误类型，包含格式错误、级别错误等变体
  - 添加基础的错误处理和日志记录功能
  - _Requirements: 6.1, 6.2, 7.1_

- [x] 2. 实现编号状态管理器
  - 在 `src/numbering/state.rs` 中实现 `NumberingState` 结构体
  - 实现编号计数器的递增、重置和查询方法
  - 处理跳级标题的编号逻辑（如H1直接跳到H3）
  - 编写单元测试验证状态管理的正确性
  - _Requirements: 2.1, 2.2, 2.3, 2.5_

- [x] 3. 实现编号格式化器
  - 在 `src/numbering/formatter.rs` 中实现 `NumberingFormatter`
  - 实现编号格式字符串的解析逻辑（%1.%2.等模式）
  - 实现编号状态到最终编号字符串的格式化
  - 添加格式验证功能，确保编号格式的有效性
  - 编写单元测试覆盖各种编号格式模式
  - _Requirements: 1.2, 1.3, 3.1, 3.2, 3.3_

- [x] 4. 扩展配置模型以支持编号字段
  - 在 `src/config/models.rs` 中为 `HeadingStyle` 添加 `numbering` 字段
  - 更新配置验证逻辑，验证编号格式的有效性
  - 确保配置的序列化和反序列化正确处理新字段
  - 更新默认配置，保持向后兼容性
  - 编写测试验证配置模型的扩展
  - _Requirements: 1.1, 1.4, 1.5_

- [x] 5. 实现标题处理器
  - 在 `src/numbering/processor.rs` 中实现 `HeadingProcessor`
  - 集成编号状态管理器和格式化器
  - 实现标题文本与编号前缀的合并逻辑
  - 处理配置中有编号和无编号标题的混合情况
  - 编写集成测试验证标题处理的完整流程
  - _Requirements: 2.4, 3.4, 4.1, 4.2_

- [x] 6. 集成编号功能到docx生成器
  - 修改 `src/docx/generator.rs` 中的 `add_heading` 方法
  - 在标题处理过程中应用编号逻辑
  - 确保编号前缀与标题样式保持一致
  - 保持与现有标题处理逻辑的兼容性
  - 编写测试验证docx输出中编号的正确显示
  - _Requirements: 4.3, 6.3, 6.4_

- [x] 7. 更新自然语言配置处理
  - 修改 `src/llm/prompts.rs` 中的配置提示模板
  - 添加编号相关的自然语言理解规则
  - 实现编号格式的自然语言到配置的转换
  - 处理编号配置的添加、修改和删除操作
  - 编写测试验证自然语言配置的准确性
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 8. 添加Web界面编号预览功能
  - 修改前端组件以支持编号预览
  - 更新 `frontend/src/components/ConfigPreview.tsx` 显示带编号的标题
  - 实现配置变更时编号预览的实时更新
  - 添加编号格式错误的用户友好提示
  - 编写前端测试验证预览功能的正确性
  - _Requirements: 7.1, 7.2, 7.3, 7.4_

- [x] 9. 实现编号功能的错误处理和日志
  - 在各个组件中添加详细的错误处理逻辑
  - 实现编号功能的优雅降级机制
  - 添加编号相关的调试和警告日志
  - 确保编号错误不影响其他功能的正常运行
  - 编写测试验证错误处理的健壮性
  - _Requirements: 6.5, 6.6_

- [x] 10. 编写综合测试和文档
  - 创建端到端测试，验证完整的编号功能流程
  - 测试各种编号格式和复杂标题结构的处理
  - 验证与现有功能的兼容性和性能影响
  - 更新API文档和用户指南，说明编号功能的使用方法
  - 添加编号功能的配置示例和最佳实践
  - _Requirements: 所有需求的综合验证_